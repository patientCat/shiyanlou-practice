# ping的实现
## 实现原理
ICMP协议
> ICMP是Internet控制报文协议。它是TCP/IP协议族到的一个子协议，用于在IP主机，路由器之间传递控制消息。属于网络层协议。

控制消息有
> * 目的不可达消息
> * 超时信息
> * 重定向信息
> * 时间戳请求和时间戳响应消息
> * 回显请求和回显应答消息

ping命令的机制是`回显请求`和`回显应答消息`。具体表现是向网络上的另一个主机系统发送ICMP报文，如果指定系统得到了报文，它将把报文一模一样地传回给发送者。<br/>

下面来看下回显请求和回显应答消息ICMP报文格式（它们的格式都一样）<br/>

```cpp
struct icmp{
    unsigned char type; // 类型 1
    unsigned char code; // 代码 1
    unsigned short checksum; // 校验和 2
    unsigned short id; // 标识符 2
    unsigned short sequence; // 序号 2
    struct timeval timestamp; // 数据 4 (数据的本质就是时间戳，在icmp中)
};
```
类型字段：
> 回显请求报文其中类型为0， 代码为0<br/>
> 回显应答报文其中类型为8， 代码为0<br/>

校验和字段：<br/>
标识符字段：<br/>
> 用于唯一标识ICMP报文，本项目中使用程序的进程id。因为如果同时在俩个命令行终端进行ping命令的话，每个ping命令都会接收到所有的回显应答，所以需要根据标识符来判断回显应答是否应该接收

序号字段：<br/>
数据字段：<br/>
> 也就是报文，我们将发送报文的时间戳放入数据字段，这样当接收该报文应答的时候可以取出发送时间戳，将接收应答的时间戳减去发送时间戳就是报文往返时间（rtt）
